<!-- templates/index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>AI Object Detection - YOLO + EasyOCR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { background:#111; color:#fff; font-family: Arial, Helvetica, sans-serif; margin:0; padding:20px; }
    .container { display:flex; gap:20px; align-items:flex-start; }
    .video-box { flex: 1; text-align:center; }
    .video-box img { max-width:100%; border-radius:8px; border: 3px solid #444; }
    .info { width:360px; background:#0f1720; padding:12px; border-radius:8px; border:1px solid #222; }
    .object { padding:8px; border-bottom:1px dashed #222; }
    .object:last-child { border-bottom:none; }
    h1 { margin:0 0 12px 0; font-size:20px; }
    .small { color:#bbb; font-size:13px; }
    code { background:#0a0a0a; padding:2px 6px; border-radius:4px; }
  </style>
</head>
<body>
  <h1>AI Object Detection â€” YOLOv8 + EasyOCR</h1>
  <div class="container">
    <div class="video-box">
      <img id="video" src="/video_feed" alt="video stream" />
      <div class="small">Press Ctrl+C in terminal or stop server to end.</div>
    </div>

    <div class="info">
      <h2>Detected Objects</h2>
      <div id="objects">No objects yet.</div>
    </div>
  </div>

  <script>
    async function fetchMetadata(){
      try {
        const res = await fetch('/metadata');
        if (!res.ok) return;
        const data = await res.json();
        const objDiv = document.getElementById('objects');
        objDiv.innerHTML = '';
        if (!data || !data.objects || data.objects.length === 0) {
          objDiv.innerHTML = '<div class="small">No objects detected</div>';
          return;
        }
        data.objects.forEach((it, idx) => {
          const el = document.createElement('div');
          el.className = 'object';
          el.innerHTML = `
            <b>${idx+1}. ${it.class}</b>
            <div class="small">Confidence: ${it.confidence ? it.confidence.toFixed(2) : '-'}</div>
            <div>OCR: <code>${it.ocr_text || '-'}</code></div>
            <div>Color: <code>${it.color_name}</code> <span style="background: rgb(${it.dominant_rgb.r},${it.dominant_rgb.g},${it.dominant_rgb.b}); width:18px; height:14px; display:inline-block; margin-left:8px; vertical-align:middle; border:1px solid #222;"></span></div>
            <div>Size: ${it.size.w} x ${it.size.h} px</div>
            <div>Shape: ${it.shape}</div>
          `;
          objDiv.appendChild(el);
        });
      } catch (e) {
        // console.log("meta fetch error", e);
      }
    }

    // Poll metadata every 500ms
    setInterval(fetchMetadata, 500);
    fetchMetadata();
  </script>
</body>
</html>
